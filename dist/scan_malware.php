<?php
set_time_limit(0);

$dangerous_functions = ['eval', 'exec', 'shell_exec', 'system', 'passthru', 'base64_decode', 'gzinflate', 'str_rot13', 'create_function'];
$suspicious_patterns = ['eval\(base64_decode', 'eval\(gzinflate', 'preg_replace\(.*/e', 'assert\(', 'include\($_GET'];

function scanDirectory($dir) {
    global $dangerous_functions, $suspicious_patterns;
    $files = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($dir));
    foreach ($files as $file) {
        if ($file->isFile() && strtolower($file->getExtension()) === 'php') {
            $path = $file->getRealPath();
            $code = file_get_contents($path);

            foreach ($dangerous_functions as $func) {
                if (stripos($code, $func) !== false) {
                    echo "<strong>‚ö†Ô∏è Ditemukan fungsi mencurigakan <code>$func</code> di file:</strong> $path<br>";
                }
            }

            foreach ($suspicious_patterns as $pattern) {
                if (preg_match("/$pattern/i", $code)) {
                    echo "<strong>üö® Pola mencurigakan cocok:</strong> <code>$pattern</code> di file: $path<br>";
                }
            }
        }
    }
}

echo "<h2>üîç Mulai Scan Folder Saat Ini: " . __DIR__ . "</h2>";
scanDirectory(__DIR__);
echo "<hr><strong>Selesai</strong>";
?>
